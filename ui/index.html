<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PyArmor POC — Advanced Interactive UI</title>
<style>
  :root{
    --bg:#f7fbff; --card:#ffffff; --muted:#6b7280;
    --accent1:#7c3aed; --accent2:#06b6d4;
    --success:#16a34a; --danger:#ef4444;
  }
  [data-theme="dark"]{
    --bg:#071024; --card:#071831; --muted:#9ca3af;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),white);color:#0f172a}
  .wrap{max-width:1100px;margin:28px auto;padding:18px}
  .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 14px 40px rgba(2,6,23,0.06);border:1px solid rgba(15,23,42,0.04);display:grid;grid-template-columns:1fr 360px;gap:18px}
  header{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:18px}
  h1{margin:0;font-size:20px}
  p.lead{margin:4px 0 0;color:var(--muted);font-size:13px}
  .form-row{margin-top:12px}
  label{display:block;font-size:13px;color:#111;margin-bottom:6px}
  input[type="text"], select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef8;font-size:14px;box-sizing:border-box}
  .controls{display:flex;gap:10px;margin-top:12px}
  .btn{padding:10px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
  .btn-primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white}
  .btn-ghost{background:white;border:1px solid #eef6fb}
  .status{margin-top:10px;font-size:13px;color:var(--muted)}
  .out{margin-top:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fbfdff,#ffffff);border:1px solid #eef6fb;font-size:15px}
  .right{background:linear-gradient(180deg,#ffffff,#fbfdff);padding:14px;border-radius:12px;border:1px solid rgba(15,23,42,0.03)}
  .history{max-height:360px;overflow:auto;padding:8px;border-radius:8px;background:#fbfdff;border:1px solid #eef6fb}
  .hist-item{padding:10px;border-radius:8px;margin-bottom:8px;background:white;border:1px solid #eef2ff}
  .muted{color:var(--muted);font-size:13px}
  .loader{display:inline-block;width:18px;height:18px;border-radius:50%;border:3px solid rgba(0,0,0,0.08);border-top-color:var(--accent1);animation:spin 1s linear infinite;vertical-align:middle;margin-left:8px}
  @keyframes spin{to{transform:rotate(360deg)}}
  .toast{position:fixed;right:20px;bottom:20px;background:#111;color:white;padding:10px 14px;border-radius:10px;box-shadow:0 8px 24px rgba(2,6,23,0.16);display:none}
  .small{font-size:13px;color:var(--muted)}
  .opt-row{display:flex;gap:8px;align-items:center}
  .examples{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
  .chip{padding:6px 8px;border-radius:999px;background:#f1f5f9;border:1px solid #e6eef8;cursor:pointer}
  .top-actions{display:flex;gap:8px;align-items:center}
  .divider{height:1px;background:#eef2ff;margin:12px 0;border-radius:2px}
  .rawjson{white-space:pre-wrap;background:#0f172a;color:#e6eef8;padding:8px;border-radius:8px;margin-top:8px;display:none}
  @media (max-width:980px){ .card{grid-template-columns:1fr} .right{order:2} }
</style>
</head>
<body>
  <div class="wrap" id="app">
    <div class="card" role="main" aria-label="Advanced UI">
      <div>
        <header>
          <div class="logo">PY</div>
          <div>
            <h1>POC - Obfuscating Python Code</h1>
            <p class="lead">The code is obfuscated using pyarmor</p>
          </div>
          <div style="margin-left:auto;" class="top-actions">
            <button id="themeToggle" class="btn btn-ghost">Toggle Theme</button>
            <label class="small" style="margin-left:8px"><input id="autoHealth" type="checkbox" checked/> Auto health</label>
          </div>
        </header>

        <div class="form-row">
          <label for="endpoint">Endpoint</label>
          <select id="endpoint">
            <option value="/api/greet">/api/greet (wrapper)</option>
            <option value="/hello/greet">/hello/greet (blueprint)</option>
          </select>
        </div>

        <div class="form-row">
          <label for="name">Name</label>
          <input id="name" type="text" placeholder="World" maxlength="60" />
        </div>

        <div class="form-row opt-row">
          <div style="flex:1">
            <label for="tone">Tone</label>
            <select id="tone">
              <option value="normal">Normal</option>
              <option value="excited">Excited</option>
              <option value="formal">Formal</option>
              <option value="funny">Funny</option>
            </select>
          </div>

          <div style="width:140px">
            <label for="lang">Language</label>
            <select id="lang">
              <option value="en">English</option>
              <option value="te">Telugu (demo)</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="controls">
            <button id="call" class="btn btn-primary">Get greeting</button>
            <button id="copy" class="btn btn-ghost">Copy</button>
            <button id="download" class="btn btn-ghost">Download CSV</button>
            <button id="clear" class="btn btn-ghost">Clear history</button>
          </div>
          <div style="margin-top:8px" class="small">Cooldown: <span id="cooldown">0</span>s</div>
        </div>

        <div class="form-row">
          <label>Quick examples</label>
          <div class="examples" id="examples">
            <div class="chip">World</div>
            <div class="chip">Alice</div>
            <div class="chip">Bob</div>
            <div class="chip">Team</div>
            <div class="chip">DevOps</div>
          </div>
        </div>

        <div class="form-row">
          <div class="status">Backend: <strong id="online">checking…</strong></div>
        </div>

        <div id="out" class="out" style="display:none;">
          <div style="font-weight:700">Response</div>
          <div id="resp" style="margin-top:8px;word-break:break-word"></div>
          <div style="margin-top:8px" class="small">Raw JSON <label><input id="showRaw" type="checkbox" /> show</label></div>
          <pre id="raw" class="rawjson"></pre>
        </div>
      </div>

      <aside class="right" aria-label="Side panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="muted">Recent activity</div>
          <div class="muted">v1.1</div>
        </div>

        <div style="margin-top:12px" class="history" id="history">
          <div class="muted">No greetings yet</div>
        </div>

        <div class="divider"></div>

        <div class="muted" style="font-size:13px">
          <div><strong>Notes</strong></div>
          <ul style="padding-left:18px;margin:6px 0">
            <li>Choose endpoint and tone, then click <em>Get greeting</em>.</li>
            <li>Language toggle is a client-side demo transform (backend still returns English).</li>
            <li>All features are client-side only; no backend changes required.</li>
          </ul>
        </div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
/* Advanced UI behavior */
const endpointEl = document.getElementById('endpoint');
const nameEl = document.getElementById('name');
const toneEl = document.getElementById('tone');
const langEl = document.getElementById('lang');
const callBtn = document.getElementById('call');
const copyBtn = document.getElementById('copy');
const downloadBtn = document.getElementById('download');
const clearBtn = document.getElementById('clear');
const examples = document.getElementById('examples');
const onlineEl = document.getElementById('online');
const outBox = document.getElementById('out');
const respEl = document.getElementById('resp');
const rawEl = document.getElementById('raw');
const showRawEl = document.getElementById('showRaw');
const historyEl = document.getElementById('history');
const toast = document.getElementById('toast');
const cooldownEl = document.getElementById('cooldown');
const autoHealth = document.getElementById('autoHealth');
const themeToggle = document.getElementById('themeToggle');

let history = [];
let cooldown = 0;
let cooldownInterval = null;

/* theme */
(function(){
  const theme = localStorage.getItem('ui-theme') || 'light';
  if(theme === 'dark') document.documentElement.setAttribute('data-theme','dark');
})();
themeToggle.addEventListener('click', ()=>{
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  if(isDark){ document.documentElement.removeAttribute('data-theme'); localStorage.setItem('ui-theme','light'); }
  else { document.documentElement.setAttribute('data-theme','dark'); localStorage.setItem('ui-theme','dark'); }
});

/* helper toast */
function toastMsg(msg, t=3000){
  toast.textContent = msg; toast.style.display='block';
  setTimeout(()=>toast.style.display='none', t);
}

/* render history */
function renderHistory(){
  historyEl.innerHTML = '';
  if(history.length===0){ historyEl.innerHTML = '<div class="muted">No greetings yet</div>'; return; }
  for(const item of history){
    const div = document.createElement('div'); div.className='hist-item';
    div.innerHTML = `<div style="font-weight:700">${escapeHtml(item.greeting)}</div>
                     <div class="small" style="margin-top:6px">${escapeHtml(item.ts)} • <span class="muted">${escapeHtml(item.meta)}</span></div>`;
    historyEl.appendChild(div);
  }
}

/* safe HTML escape */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* client-side language transform (demo only) */
function translateDemo(text, lang){
  if(lang === 'te'){
    // super-simple fixed demo mapping for 'Hello' style -> Telugu greeting (not real translation)
    return text.replace(/Hello,?\s*(.*)!?/i, (m,p)=> `హలో, ${p || 'ప్రపంచం'}!`);
  }
  return text;
}

/* start cooldown (client-side anti-spam) */
function startCooldown(seconds){
  cooldown = seconds; cooldownEl.textContent = cooldown;
  if(cooldownInterval) clearInterval(cooldownInterval);
  cooldownInterval = setInterval(()=>{ cooldown--; cooldownEl.textContent = cooldown; if(cooldown<=0){ clearInterval(cooldownInterval); cooldownInterval=null; cooldownEl.textContent=0; } },1000);
}

/* call API */
async function callGreet(){
  if(cooldown > 0){ toastMsg('Please wait ' + cooldown + 's before next call', 2000); return; }
  const endpoint = endpointEl.value;
  let name = (nameEl.value || '').trim();
  if(!name) name = 'World';
  if(name.length > 60){ toastMsg('Name too long'); return; }

  callBtn.disabled = true;
  const loader = document.createElement('span'); loader.className='loader'; callBtn.appendChild(loader);
  try{
    const res = await fetch(endpoint, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ name })
    });
    const txt = await res.text();
    let json = null;
    try{ json = JSON.parse(txt); } catch(e){ json = null; }
    let greeting = (json && json.greeting) ? json.greeting : (json ? JSON.stringify(json) : txt);

    // apply tone
    const tone = toneEl.value;
    if(tone === 'excited') greeting += ' 🎉';
    else if(tone === 'formal') greeting = 'Good day, ' + (name || 'Sir/Madam');
    else if(tone === 'funny') greeting = (greeting + ' 😜').replace(/Hello/,'Howdy');

    // language demo transform
    const lang = langEl.value; greeting = translateDemo(greeting, lang);

    // show
    respEl.textContent = greeting;
    outBox.style.display = 'block';
    if(showRawEl.checked){ rawEl.style.display='block'; rawEl.textContent = txt; } else { rawEl.style.display='none'; }

    // history
    const meta = `endpoint=${endpoint} tone=${tone} lang=${lang}`;
    history.unshift({ greeting, ts: new Date().toLocaleString(), meta });
    if(history.length > 50) history.pop();
    renderHistory();

    startCooldown(3); // minimal cooldown
  }catch(err){
    toastMsg('Request failed: ' + err.message, 4000);
  }finally{
    callBtn.disabled = false;
    if(callBtn.contains(loader)) callBtn.removeChild(loader);
  }
}

/* copy to clipboard */
copyBtn.addEventListener('click', async ()=>{
  const text = respEl.textContent || '';
  if(!text){ toastMsg('Nothing to copy'); return; }
  try{
    await navigator.clipboard.writeText(text);
    toastMsg('Copied to clipboard');
  }catch(e){ toastMsg('Copy failed: ' + e.message); }
});

/* download CSV */
downloadBtn.addEventListener('click', ()=>{
  if(history.length==0){ toastMsg('No history to download'); return; }
  const rows = [['greeting','timestamp','meta']];
  for(const r of history) rows.push([r.greeting.replace(/"/g,'""'), r.ts, r.meta]);
  const csv = rows.map(r=> r.map(c=> '"'+c+'"').join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='greetings.csv'; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
});

/* clear history */
clearBtn.addEventListener('click', ()=>{ history=[]; renderHistory(); toastMsg('History cleared'); });

/* example chips */
examples.addEventListener('click', (e)=>{
  const chip = e.target.closest('.chip');
  if(!chip) return;
  nameEl.value = chip.textContent;
});

/* show raw toggle */
showRawEl.addEventListener('change', ()=>{ rawEl.style.display = showRawEl.checked ? 'block' : 'none'; });

/* health check */
async function checkHealth(){
  try{
    const r = await fetch('/api/health', {method:'GET'});
    if(r.ok){ onlineEl.textContent='online'; onlineEl.style.color='green'; }
    else { onlineEl.textContent='offline'; onlineEl.style.color='red'; }
  }catch(e){ onlineEl.textContent='offline'; onlineEl.style.color='red'; }
}
checkHealth();
setInterval(()=>{ if(autoHealth.checked) checkHealth(); }, 6000);

/* keyboard enter */
nameEl.addEventListener('keyup', (e)=>{ if(e.key==='Enter') callGreet(); });

/* bind call btn */
callBtn.addEventListener('click', callGreet);

/* initial render */
renderHistory();
</script>
</body>
</html>

